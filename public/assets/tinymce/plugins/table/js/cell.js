function init(){ed=tinyMCEPopup.editor,tinyMCEPopup.resizeToInnerSize(),document.getElementById("backgroundimagebrowsercontainer").innerHTML=getBrowserHTML("backgroundimagebrowser","backgroundimage","image","table"),document.getElementById("bordercolor_pickcontainer").innerHTML=getColorPickerHTML("bordercolor_pick","bordercolor"),document.getElementById("bgcolor_pickcontainer").innerHTML=getColorPickerHTML("bgcolor_pick","bgcolor");var a=ed,b=ed.dom.getParent(ed.selection.getStart(),"td,th"),c=document.forms[0],d=ed.dom.parseStyle(ed.dom.getAttrib(b,"style")),e=b.nodeName.toLowerCase(),f=ed.dom.getAttrib(b,"align"),g=ed.dom.getAttrib(b,"valign"),h=trimSize(getStyle(b,"width","width")),i=trimSize(getStyle(b,"height","height")),j=convertRGBToHex(getStyle(b,"bordercolor","borderLeftColor")),k=convertRGBToHex(getStyle(b,"bgcolor","backgroundColor")),l=ed.dom.getAttrib(b,"class"),m=getStyle(b,"background","backgroundImage").replace(new RegExp("url\\(['\"]?([^'\"]*)['\"]?\\)","gi"),"$1"),n=ed.dom.getAttrib(b,"id"),o=ed.dom.getAttrib(b,"lang"),p=ed.dom.getAttrib(b,"dir"),q=ed.dom.getAttrib(b,"scope");addClassesToList("class","table_cell_styles"),TinyMCE_EditableSelects.init(),ed.dom.hasClass(b,"mceSelected")?tinyMCEPopup.dom.hide("action"):(c.bordercolor.value=j,c.bgcolor.value=k,c.backgroundimage.value=m,c.width.value=h,c.height.value=i,c.id.value=n,c.lang.value=o,c.style.value=ed.dom.serializeStyle(d),selectByValue(c,"align",f),selectByValue(c,"valign",g),selectByValue(c,"class",l,!0,!0),selectByValue(c,"celltype",e),selectByValue(c,"dir",p),selectByValue(c,"scope",q),isVisible("backgroundimagebrowser")&&(document.getElementById("backgroundimage").style.width="180px"),updateColor("bordercolor_pick","bordercolor"),updateColor("bgcolor_pick","bgcolor"))}function updateAction(){var a,b=ed,c,d,e,f=document.forms[0];if(!AutoValidator.validate(f))return tinyMCEPopup.alert(AutoValidator.getErrorMessages(f).join(". ")+"."),!1;tinyMCEPopup.restoreSelection(),a=ed.selection.getStart(),c=ed.dom.getParent(a,"td,th"),d=ed.dom.getParent(a,"tr"),e=ed.dom.getParent(a,"table");if(ed.dom.hasClass(c,"mceSelected")){tinymce.each(ed.dom.select("td.mceSelected,th.mceSelected"),function(a){updateCell(a)}),ed.addVisual(),ed.nodeChanged(),b.execCommand("mceEndUndoLevel"),tinyMCEPopup.close();return}switch(getSelectValue(f,"action")){case"cell":var g=getSelectValue(f,"celltype"),h=getSelectValue(f,"scope");function i(a){a&&(updateCell(c),ed.addVisual(),ed.nodeChanged(),b.execCommand("mceEndUndoLevel"),tinyMCEPopup.close())}if(ed.getParam("accessibility_warnings",1)){g=="th"&&h==""?tinyMCEPopup.confirm(ed.getLang("table_dlg.missing_scope","",!0),i):i(1);return}updateCell(c);break;case"row":var j=d.firstChild;j.nodeName!="TD"&&j.nodeName!="TH"&&(j=nextCell(j));do j=updateCell(j,!0);while((j=nextCell(j))!=null);break;case"col":var k,l=0,j=d.firstChild,m=e.getElementsByTagName("tr");j.nodeName!="TD"&&j.nodeName!="TH"&&(j=nextCell(j));do{if(j==c)break;l+=j.getAttribute("colspan")}while((j=nextCell(j))!=null);for(var n=0;n<m.length;n++){j=m[n].firstChild,j.nodeName!="TD"&&j.nodeName!="TH"&&(j=nextCell(j)),k=0;do{if(k==l){j=updateCell(j,!0);break}k+=j.getAttribute("colspan")}while((j=nextCell(j))!=null)}break;case"all":var m=e.getElementsByTagName("tr");for(var n=0;n<m.length;n++){var j=m[n].firstChild;j.nodeName!="TD"&&j.nodeName!="TH"&&(j=nextCell(j));do j=updateCell(j,!0);while((j=nextCell(j))!=null)}}ed.addVisual(),ed.nodeChanged(),b.execCommand("mceEndUndoLevel"),tinyMCEPopup.close()}function nextCell(a){while((a=a.nextSibling)!=null)if(a.nodeName=="TD"||a.nodeName=="TH")return a;return null}function updateCell(a,b){var c=ed,d=document.forms[0],e=a.nodeName.toLowerCase(),f=getSelectValue(d,"celltype"),g=c.getDoc(),h=ed.dom;b||h.setAttrib(a,"id",d.id.value),h.setAttrib(a,"align",d.align.value),h.setAttrib(a,"vAlign",d.valign.value),h.setAttrib(a,"lang",d.lang.value),h.setAttrib(a,"dir",getSelectValue(d,"dir")),h.setAttrib(a,"style",ed.dom.serializeStyle(ed.dom.parseStyle(d.style.value))),h.setAttrib(a,"scope",d.scope.value),h.setAttrib(a,"class",getSelectValue(d,"class")),ed.dom.setAttrib(a,"width",""),ed.dom.setAttrib(a,"height",""),ed.dom.setAttrib(a,"bgColor",""),ed.dom.setAttrib(a,"borderColor",""),ed.dom.setAttrib(a,"background",""),a.style.width=getCSSSize(d.width.value),a.style.height=getCSSSize(d.height.value),d.bordercolor.value!=""?(a.style.borderColor=d.bordercolor.value,a.style.borderStyle=a.style.borderStyle==""?"solid":a.style.borderStyle,a.style.borderWidth=a.style.borderWidth==""?"1px":a.style.borderWidth):a.style.borderColor="",a.style.backgroundColor=d.bgcolor.value,d.backgroundimage.value!=""?a.style.backgroundImage="url('"+d.backgroundimage.value+"')":a.style.backgroundImage="";if(e!=f){var i=g.createElement(f);for(var j=0;j<a.childNodes.length;j++)i.appendChild(a.childNodes[j].cloneNode(1));for(var k=0;k<a.attributes.length;k++)ed.dom.setAttrib(i,a.attributes[k].name,ed.dom.getAttrib(a,a.attributes[k].name));a.parentNode.replaceChild(i,a),a=i}return h.setAttrib(a,"style",h.serializeStyle(h.parseStyle(a.style.cssText))),a}function changedBackgroundImage(){var a=document.forms[0],b=ed.dom.parseStyle(a.style.value);b["background-image"]="url('"+a.backgroundimage.value+"')",a.style.value=ed.dom.serializeStyle(b)}function changedSize(){var a=document.forms[0],b=ed.dom.parseStyle(a.style.value),c=a.width.value;c!=""?b.width=getCSSSize(c):b.width="";var d=a.height.value;d!=""?b.height=getCSSSize(d):b.height="",a.style.value=ed.dom.serializeStyle(b)}function changedColor(){var a=document.forms[0],b=ed.dom.parseStyle(a.style.value);b["background-color"]=a.bgcolor.value,b["border-color"]=a.bordercolor.value,a.style.value=ed.dom.serializeStyle(b)}function changedStyle(){var a=document.forms[0],b=ed.dom.parseStyle(a.style.value);b["background-image"]?a.backgroundimage.value=b["background-image"].replace(new RegExp("url\\('?([^']*)'?\\)","gi"),"$1"):a.backgroundimage.value="",b.width&&(a.width.value=trimSize(b.width)),b.height&&(a.height.value=trimSize(b.height)),b["background-color"]&&(a.bgcolor.value=b["background-color"],updateColor("bgcolor_pick","bgcolor")),b["border-color"]&&(a.bordercolor.value=b["border-color"],updateColor("bordercolor_pick","bordercolor"))}tinyMCEPopup.requireLangPack();var ed;tinyMCEPopup.onInit.add(init);