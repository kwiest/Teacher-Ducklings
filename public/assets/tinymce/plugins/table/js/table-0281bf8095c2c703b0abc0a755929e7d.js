function insertTable(){var a=document.forms[0],b=tinyMCEPopup.editor,c=b.dom,d=2,e=2,f=0,g=-1,h=-1,i,j,k,l,m,n,o,p="",q,r,s,t,u;tinyMCEPopup.restoreSelection();if(!AutoValidator.validate(a))return tinyMCEPopup.alert(AutoValidator.getErrorMessages(a).join(". ")+"."),!1;r=c.getParent(b.selection.getNode(),"table"),d=a.elements.cols.value,e=a.elements.rows.value,f=a.elements["border"].value!=""?a.elements.border.value:0,g=a.elements["cellpadding"].value!=""?a.elements.cellpadding.value:"",h=a.elements["cellspacing"].value!=""?a.elements.cellspacing.value:"",i=getSelectValue(a,"align"),n=getSelectValue(a,"tframe"),o=getSelectValue(a,"rules"),j=a.elements.width.value,k=a.elements.height.value,bordercolor=a.elements.bordercolor.value,bgcolor=a.elements.bgcolor.value,l=getSelectValue(a,"class"),id=a.elements.id.value,summary=a.elements.summary.value,style=a.elements.style.value,dir=a.elements.dir.value,lang=a.elements.lang.value,background=a.elements.backgroundimage.value,m=a.elements.caption.checked,s=tinyMCEPopup.getParam("table_cell_limit",!1),t=tinyMCEPopup.getParam("table_row_limit",!1),u=tinyMCEPopup.getParam("table_col_limit",!1);if(u&&d>u)return tinyMCEPopup.alert(b.getLang("table_dlg.col_limit").replace(/\{\$cols\}/g,u)),!1;if(t&&e>t)return tinyMCEPopup.alert(b.getLang("table_dlg.row_limit").replace(/\{\$rows\}/g,t)),!1;if(s&&d*e>s)return tinyMCEPopup.alert(b.getLang("table_dlg.cell_limit").replace(/\{\$cells\}/g,s)),!1;if(action=="update")return c.setAttrib(r,"cellPadding",g,!0),c.setAttrib(r,"cellSpacing",h,!0),isCssSize(f)?c.setAttrib(r,"border",""):c.setAttrib(r,"border",f),f==""&&(c.setStyle(r,"border-width",""),c.setStyle(r,"border",""),c.setAttrib(r,"border","")),c.setAttrib(r,"align",i),c.setAttrib(r,"frame",n),c.setAttrib(r,"rules",o),c.setAttrib(r,"class",l),c.setAttrib(r,"style",style),c.setAttrib(r,"id",id),c.setAttrib(r,"summary",summary),c.setAttrib(r,"dir",dir),c.setAttrib(r,"lang",lang),q=b.dom.select("caption",r)[0],q&&!m&&q.parentNode.removeChild(q),!q&&m&&(q=r.ownerDocument.createElement("caption"),tinymce.isIE||(q.innerHTML='<br data-mce-bogus="1"/>'),r.insertBefore(q,r.firstChild)),j&&b.settings.inline_styles?(c.setStyle(r,"width",j),c.setAttrib(r,"width","")):(c.setAttrib(r,"width",j,!0),c.setStyle(r,"width","")),c.setAttrib(r,"borderColor",""),c.setAttrib(r,"bgColor",""),c.setAttrib(r,"background",""),k&&b.settings.inline_styles?(c.setStyle(r,"height",k),c.setAttrib(r,"height","")):(c.setAttrib(r,"height",k,!0),c.setStyle(r,"height","")),background!=""?r.style.backgroundImage="url('"+background+"')":r.style.backgroundImage="",bordercolor!=""?(r.style.borderColor=bordercolor,r.style.borderStyle=r.style.borderStyle==""?"solid":r.style.borderStyle,r.style.borderWidth=cssSize(f)):r.style.borderColor="",r.style.backgroundColor=bgcolor,r.style.height=getCSSSize(k),b.addVisual(),b.nodeChanged(),b.execCommand("mceEndUndoLevel"),(a.width.value!=orgTableWidth||a.height.value!=orgTableHeight)&&b.execCommand("mceRepaint"),tinyMCEPopup.close(),!0;p+="<table",p+=makeAttrib("id",id),isCssSize(f)||(p+=makeAttrib("border",f)),p+=makeAttrib("cellpadding",g),p+=makeAttrib("cellspacing",h),p+=makeAttrib("data-mce-new","1"),j&&b.settings.inline_styles?(style&&(style+="; "),/^[0-9\.]+$/.test(j)&&(j+="px"),style+="width: "+j):p+=makeAttrib("width",j),p+=makeAttrib("align",i),p+=makeAttrib("frame",n),p+=makeAttrib("rules",o),p+=makeAttrib("class",l),p+=makeAttrib("style",style),p+=makeAttrib("summary",summary),p+=makeAttrib("dir",dir),p+=makeAttrib("lang",lang),p+=">",m&&(tinymce.isIE?p+="<caption></caption>":p+='<caption><br data-mce-bogus="1"/></caption>');for(var v=0;v<e;v++){p+="<tr>";for(var w=0;w<d;w++)tinymce.isIE?p+="<td></td>":p+='<td><br data-mce-bogus="1"/></td>';p+="</tr>"}p+="</table>";if(b.settings.fix_table_elements){var x="";b.focus(),b.selection.setContent('<br class="_mce_marker" />'),tinymce.each("h1,h2,h3,h4,h5,h6,p".split(","),function(a){x&&(x+=","),x+=a+" ._mce_marker"}),tinymce.each(b.dom.select(x),function(a){b.dom.split(b.dom.getParent(a,"h1,h2,h3,h4,h5,h6,p"),a)}),c.setOuterHTML(c.select("br._mce_marker")[0],p)}else b.execCommand("mceInsertContent",!1,p);tinymce.each(c.select("table[data-mce-new]"),function(a){tinymce.isIE&&a.nextSibling==null&&c.insertAfter(c.create("p"),a);var d=c.select("td,th",a);try{b.selection.setCursorLocation(d[0],0)}catch(e){}c.setAttrib(a,"data-mce-new","")}),b.addVisual(),b.execCommand("mceEndUndoLevel"),tinyMCEPopup.close()}function makeAttrib(a,b){var c=document.forms[0],d=c.elements[a];if(typeof b=="undefined"||b==null)b="",d&&(b=d.value);return b==""?"":(b=b.replace(/&/g,"&amp;"),b=b.replace(/\"/g,"&quot;"),b=b.replace(/</g,"&lt;"),b=b.replace(/>/g,"&gt;")," "+a+'="'+b+'"')}function init(){tinyMCEPopup.resizeToInnerSize(),document.getElementById("backgroundimagebrowsercontainer").innerHTML=getBrowserHTML("backgroundimagebrowser","backgroundimage","image","table"),document.getElementById("backgroundimagebrowsercontainer").innerHTML=getBrowserHTML("backgroundimagebrowser","backgroundimage","image","table"),document.getElementById("bordercolor_pickcontainer").innerHTML=getColorPickerHTML("bordercolor_pick","bordercolor"),document.getElementById("bgcolor_pickcontainer").innerHTML=getColorPickerHTML("bgcolor_pick","bgcolor");var a=2,b=2,c=tinyMCEPopup.getParam("table_default_border","0"),d=tinyMCEPopup.getParam("table_default_cellpadding",""),e=tinyMCEPopup.getParam("table_default_cellspacing",""),f="",g="",h="",i="",j="",k="",l="",m="",n="",o="",p="",q="",j="",i="",r="",s="",t=tinyMCEPopup.editor,u=t.dom,v=document.forms[0],w=u.getParent(t.selection.getNode(),"table");action=tinyMCEPopup.getWindowArg("action"),action||(action=w?"update":"insert");if(w&&action!="insert"){var x=w.rows,a=0;for(var y=0;y<x.length;y++)x[y].cells.length>a&&(a=x[y].cells.length);a=a,b=x.length,st=u.parseStyle(u.getAttrib(w,"style")),c=trimSize(getStyle(w,"border","borderWidth")),d=u.getAttrib(w,"cellpadding",""),e=u.getAttrib(w,"cellspacing",""),g=trimSize(getStyle(w,"width","width")),h=trimSize(getStyle(w,"height","height")),i=convertRGBToHex(getStyle(w,"bordercolor","borderLeftColor")),j=convertRGBToHex(getStyle(w,"bgcolor","backgroundColor")),f=u.getAttrib(w,"align",f),s=u.getAttrib(w,"frame"),r=u.getAttrib(w,"rules"),k=tinymce.trim(u.getAttrib(w,"class").replace(/mceItem.+/g,"")),l=u.getAttrib(w,"id"),m=u.getAttrib(w,"summary"),n=u.serializeStyle(st),o=u.getAttrib(w,"dir"),p=u.getAttrib(w,"lang"),q=getStyle(w,"background","backgroundImage").replace(new RegExp("url\\(['\"]?([^'\"]*)['\"]?\\)","gi"),"$1"),v.caption.checked=w.getElementsByTagName("caption").length>0,orgTableWidth=g,orgTableHeight=h,action="update",v.insert.value=t.getLang("update")}addClassesToList("class","table_styles"),TinyMCE_EditableSelects.init(),selectByValue(v,"align",f),selectByValue(v,"tframe",s),selectByValue(v,"rules",r),selectByValue(v,"class",k,!0,!0),v.cols.value=a,v.rows.value=b,v.border.value=c,v.cellpadding.value=d,v.cellspacing.value=e,v.width.value=g,v.height.value=h,v.bordercolor.value=i,v.bgcolor.value=j,v.id.value=l,v.summary.value=m,v.style.value=n,v.dir.value=o,v.lang.value=p,v.backgroundimage.value=q,updateColor("bordercolor_pick","bordercolor"),updateColor("bgcolor_pick","bgcolor"),isVisible("backgroundimagebrowser")&&(document.getElementById("backgroundimage").style.width="180px"),action=="update"&&(v.cols.disabled=!0,v.rows.disabled=!0)}function changedSize(){var a=document.forms[0],b=dom.parseStyle(a.style.value),c=a.height.value;c!=""?b.height=getCSSSize(c):b.height="",a.style.value=dom.serializeStyle(b)}function isCssSize(a){return/^[0-9.]+(%|in|cm|mm|em|ex|pt|pc|px)$/.test(a)}function cssSize(a,b){return a=tinymce.trim(a||b),isCssSize(a)?a:parseInt(a,10)+"px"}function changedBackgroundImage(){var a=document.forms[0],b=dom.parseStyle(a.style.value);b["background-image"]="url('"+a.backgroundimage.value+"')",a.style.value=dom.serializeStyle(b)}function changedBorder(){var a=document.forms[0],b=dom.parseStyle(a.style.value);a.border.value==""||!isCssSize(a.border.value)&&a.bordercolor.value==""?a.border.value||(b.border="",b["border-width"]=""):b["border-width"]=cssSize(a.border.value),a.style.value=dom.serializeStyle(b)}function changedColor(){var a=document.forms[0],b=dom.parseStyle(a.style.value);b["background-color"]=a.bgcolor.value,a.bordercolor.value!=""&&(b["border-color"]=a.bordercolor.value,b["border-width"]||(b["border-width"]=cssSize(a.border.value,1))),a.style.value=dom.serializeStyle(b)}function changedStyle(){var a=document.forms[0],b=dom.parseStyle(a.style.value);b["background-image"]?a.backgroundimage.value=b["background-image"].replace(new RegExp("url\\(['\"]?([^'\"]*)['\"]?\\)","gi"),"$1"):a.backgroundimage.value="",b.width&&(a.width.value=trimSize(b.width)),b.height&&(a.height.value=trimSize(b.height)),b["background-color"]&&(a.bgcolor.value=b["background-color"],updateColor("bgcolor_pick","bgcolor")),b["border-color"]&&(a.bordercolor.value=b["border-color"],updateColor("bordercolor_pick","bordercolor"))}tinyMCEPopup.requireLangPack();var action,orgTableWidth,orgTableHeight,dom=tinyMCEPopup.editor.dom;tinyMCEPopup.onInit.add(init);