/**
 * editor_plugin_src.js
 *
 * Copyright 2011, Moxiecode Systems AB
 * Released under LGPL License.
 *
 * License: http://tinymce.moxiecode.com/license
 * Contributing: http://tinymce.moxiecode.com/contributing
 */
(function(){function d(a,b){while(a&&(a.nodeType===8||a.nodeType===3&&/^[ \t\n\r]*$/.test(a.nodeValue)))a=b(a);return a}function e(a){return d(a,function(a){return a.previousSibling})}function f(a){return d(a,function(a){return a.nextSibling})}function g(a,b,c){return a.dom.getParent(b,function(a){return tinymce.inArray(c,a)!==-1})}function h(a){return a&&(a.tagName==="OL"||a.tagName==="UL")}function i(a,b){var c,d,f;c=e(a.lastChild);while(h(c))d=c,c=e(d.previousSibling);return d&&(f=b.create("li",{style:"list-style-type: none;"}),b.split(a,d),b.insertAfter(f,d),f.appendChild(d),f.appendChild(d),a=f.previousSibling),a}function j(a,b,c){return a=k(a,b,c),l(a,b,c)}function k(a,b,c){var d=e(a.previousSibling);return d?m(d,a,b?d:!1,c):a}function l(a,b,c){var d=f(a.nextSibling);return d?m(a,d,b?d:!1,c):a}function m(a,b,c,d){return n(a,b,!!c,d)?q(a,b,c):(a&&a.tagName==="LI"&&h(b)&&a.appendChild(b),b)}function n(a,b,c,d){return!a||!b?!1:a.tagName==="LI"&&b.tagName==="LI"?b.style.listStyleType==="none"||p(b):h(a)?a.tagName===b.tagName&&(c||a.style.listStyleType===b.style.listStyleType)||o(b):d&&a.tagName==="P"&&b.tagName==="P"}function o(a){var b=f(a.firstChild),c=e(a.lastChild);return b&&c&&h(a)&&b===c&&(h(b)||b.style.listStyleType==="none"||p(b))}function p(a){var b=f(a.firstChild),c=e(a.lastChild);return b&&c&&b===c&&h(b)}function q(a,b,c){var d=e(a.lastChild),g=f(b.firstChild);a.tagName==="P"&&a.appendChild(a.ownerDocument.createElement("br"));while(b.firstChild)a.appendChild(b.firstChild);return c&&(a.style.listStyleType=c.style.listStyleType),b.parentNode.removeChild(b),m(d,g,!1),a}function r(a,b){var c;return b.is(a,"li,ol,ul")||(c=b.getParent(a,"li"),c&&(a=c)),a}var a=tinymce.each,b=tinymce.dom.Event,c;tinymce.create("tinymce.plugins.Lists",{init:function(a){function j(b){return b.keyCode===tinymce.VK.TAB&&!b.altKey&&!b.ctrlKey&&(a.queryCommandState("InsertUnorderedList")||a.queryCommandState("InsertOrderedList"))}function k(){var b=a.selection.getRng(),c=b.startContainer;return c.nodeType==3?b.endOffset==c.nodeValue.length:c.nodeType==1?b.endOffset==c.childNodes.length:!1}function l(){var b=a.selection.getNode(),c=b.tagName==="P"&&b.parentNode.tagName==="LI"&&b.parentNode.lastChild===b;return a.selection.isCollapsed()&&c&&k()}function m(){var a=p(),b=a.parentNode.parentNode,c=a.parentNode.lastChild===a;return c&&!n(b)&&q(a)}function n(a){return h(a)?a.parentNode&&a.parentNode.tagName==="LI":a.tagName==="LI"}function o(){return a.selection.isCollapsed()&&q(p())}function p(){var b=a.selection.getStart();return b.tagName!="BR"&&b.tagName!=""||b.parentNode.tagName!="LI"?b:b.parentNode}function q(a){var b=a.childNodes.length;return a.tagName==="LI"?b==0?!0:b==1&&(a.firstChild.tagName==""||a.firstChild.tagName=="BR"||r(a)):!1}function r(a){var b=tinymce.grep(a.parentNode.childNodes,function(a){return a.tagName=="LI"}),c=a==b[b.length-1],d=a.firstChild;return tinymce.isIE9&&c&&(d.nodeValue==String.fromCharCode(160)||d.nodeValue==String.fromCharCode(32))}function s(a){return a.keyCode===tinymce.VK.ENTER}function t(a){return s(a)&&!a.shiftKey}function u(a){return j(a)?c:t(a)&&m()?e:t(a)&&o()?d:t(a)&&l()?f:g}function v(a,f){(i==c||i==d||tinymce.isGecko&&i==e)&&b.cancel(f)}function w(a,c){if(i==f){var d=a.selection.getNode(),e=a.dom.create("li"),g=a.dom.getParent(d,"li");a.dom.insertAfter(e,g),tinyMCE.isIE8?(e.appendChild(a.dom.create("&nbsp;")),a.selection.setCursorLocation(e,1)):tinyMCE.isGecko?setTimeout(function(){var b=a.getDoc().createTextNode("﻿");e.appendChild(b),a.selection.setCursorLocation(e,0)},0):a.selection.setCursorLocation(e,0),b.cancel(c)}}function x(a,b){function e(a){var b=a.firstChild,c=null;do{if(!b)break;b.tagName==="LI"&&(c=b)}while(b=b.nextSibling);return c}function f(a,b){while(a.childNodes.length>0)b.appendChild(a.childNodes[0])}var c;if(!tinymce.isGecko)return;var d=a.selection.getStart();if(b.keyCode!=tinymce.VK.BACKSPACE||d.tagName!=="IMG")return;c=d.parentNode.previousSibling;if(!c)return;var g;if(c.tagName==="UL"||c.tagName==="OL")g=c;else{if(!c.previousSibling||c.previousSibling.tagName!=="UL"&&c.previousSibling.tagName!=="OL")return;g=c.previousSibling}var h=e(g),i=a.dom.createRng();i.setStart(h,1),i.setEnd(h,1),a.selection.setRng(i),a.selection.collapse(!0);var j=a.selection.getBookmark(),k=d.parentNode.cloneNode(!0);k.tagName==="P"||k.tagName==="DIV"?f(k,h):h.appendChild(k),d.parentNode.parentNode.removeChild(d.parentNode),a.selection.moveToBookmark(j)}function y(b){var c=a.dom.getParent(b,"ol,ul");if(c!=null){var d=c.lastChild;d.appendChild(a.getDoc().createElement("")),a.selection.setCursorLocation(d,0)}}function z(b,c){var d=a.getDoc().createTextNode("﻿");b.insertBefore(d,c),a.selection.setCursorLocation(d,0),a.execCommand("mceRepaint")}function A(a,b){if(s(b)){var c=p();if(c){var d=c.parentNode,e=d&&d.parentNode;e&&e.nodeName=="LI"&&e.firstChild==d&&c==d.firstChild&&z(e,d)}}}function B(a,b){if(s(b)){var c=p();if(a.dom.select("ul li",c).length===1){var d=c.firstChild;z(c,d)}}}function C(a,c){function d(b,c){var d=[],e=new tinymce.dom.TreeWalker(c,b);for(var f=e.current();f;f=e.next())a.dom.is(f,"ol,ul,li")&&d.push(f);return d}if(c.keyCode==tinymce.VK.BACKSPACE){var e=p();if(e){var f=a.dom.getParent(e,"ol,ul");if(f&&f.firstChild===e){var g=d(f,e);return a.execCommand("Outdent",!1,g),a.undoManager.add(),b.cancel(c)}}}}function D(a,c){var d=p();if(c.keyCode===tinymce.VK.BACKSPACE&&a.dom.is(d,"li")&&d.parentNode.firstChild!==d&&a.dom.select("ul,ol",d).length===1){var e=d.previousSibling;a.dom.remove(a.dom.select("br",d)),a.dom.remove(d,!0);var f=tinymce.grep(e.childNodes,function(a){return a.nodeType===3});if(f.length===1){var g=f[0];a.selection.setCursorLocation(g,g.length)}return a.undoManager.add(),b.cancel(c)}}var c="TABBING",d="EMPTY",e="ESCAPE",f="PARAGRAPH",g="UNKNOWN",i=g;this.ed=a,a.addCommand("Indent",this.indent,this),a.addCommand("Outdent",this.outdent,this),a.addCommand("InsertUnorderedList",function(){this.applyList("UL","OL")},this),a.addCommand("InsertOrderedList",function(){this.applyList("OL","UL")},this),a.onInit.add(function(){a.editorCommands.addCommands({outdent:function(){function d(b){return b=c.getParent(b,c.isBlock),b&&parseInt(a.dom.getStyle(b,"margin-left")||0,10)+parseInt(a.dom.getStyle(b,"padding-left")||0,10)>0}var b=a.selection,c=a.dom;return d(b.getStart())||d(b.getEnd())||a.queryCommandState("InsertOrderedList")||a.queryCommandState("InsertUnorderedList")}},"state")}),a.onKeyUp.add(function(a,f){if(i==c)return a.execCommand(f.shiftKey?"Outdent":"Indent",!0,null),i=g,b.cancel(f);if(i==d){var h=p(),j=a.settings.list_outdent_on_enter===!0||f.shiftKey;return a.execCommand(j?"Outdent":"Indent",!0,null),tinymce.isIE&&y(h),b.cancel(f)}if(i==e)if(tinymce.isIE8){var k=a.getDoc().createTextNode("﻿");a.selection.getNode().appendChild(k)}else if(tinymce.isIE9||tinymce.isGecko)return a.execCommand("Outdent"),b.cancel(f)}),a.onKeyDown.add(function(a,b){i=u(b)}),a.onKeyDown.add(v),a.onKeyDown.add(x),a.onKeyDown.add(w),tinymce.isGecko&&a.onKeyUp.add(A),tinymce.isIE8&&a.onKeyUp.add(B),(tinymce.isGecko||tinymce.isWebKit)&&a.onKeyDown.add(C),tinymce.isWebKit&&a.onKeyDown.add(D)},applyList:function(b,d){function q(a){a&&a.tagName==="BR"&&g.remove(a)}function s(a){function f(a){(a.style.marginLeft||a.style.paddingLeft)&&e.adjustPaddingFunction(!1)(a)}var c=g.create(b),d;if(a.tagName!=="LI"){if(a.tagName==="P"||a.tagName==="DIV"||a.tagName==="BODY"){u(a,function(b,c){t(b,c,a.tagName==="BODY"?null:b.parentNode),d=b.parentNode,f(d),q(c)}),d&&(d.tagName==="LI"&&(a.tagName==="P"||p.length>1)&&g.split(d.parentNode.parentNode,d.parentNode),j(d.parentNode,!0));return}d=g.create("li"),g.insertAfter(d,a),d.appendChild(a),f(a),a=d}g.insertAfter(c,a),c.appendChild(a),j(c,!0),h.push(a)}function t(a,b,c){var d,e=a,f;while(!g.isBlock(a.parentNode)&&a.parentNode!==g.getRoot())a=g.split(a.parentNode,a.previousSibling),a=a.nextSibling,e=a;if(c){d=c.cloneNode(!0),a.parentNode.insertBefore(d,a);while(d.firstChild)g.remove(d.firstChild);d=g.rename(d,"li")}else d=g.create("li"),a.parentNode.insertBefore(d,a);while(e&&e!=b)f=e.nextSibling,d.appendChild(e),e=f;d.childNodes.length===0&&(d.innerHTML='<br _mce_bogus="1" />'),s(d)}function u(b,d){function l(a,b){var d=g.createRng(),e;return c.keep=!0,f.selection.moveToBookmark(c),c.keep=!1,e=f.selection.getRng(!0),b||(b=a.parentNode.lastChild),d.setStartBefore(a),d.setEndAfter(b),!(d.compareBoundaryPoints(i,e)>0||d.compareBoundaryPoints(j,e)<=0)}function m(a){if(a.nextSibling)return a.nextSibling;if(!g.isBlock(a.parentNode)&&a.parentNode!==g.getRoot())return m(a.parentNode)}var e,h,i=3,j=1,k="br,ul,ol,p,div,h1,h2,h3,h4,h5,h6,table,blockquote,address,pre,form,center,dl";e=b.firstChild;var n=!1;a(g.select(k,b),function(a){if(a.hasAttribute&&a.hasAttribute("_mce_bogus"))return!0;l(e,a)&&(g.addClass(a,"_mce_tagged_br"),e=m(a))}),n=e&&l(e,undefined),e=b.firstChild,a(g.select(k,b),function(a){var b=m(a);if(a.hasAttribute&&a.hasAttribute("_mce_bogus"))return!0;g.hasClass(a,"_mce_tagged_br")?(d(e,a,h),h=null):h=a,e=b}),n&&d(e,undefined,h)}function v(a){u(a,function(a,b,c){t(a,b),q(b),q(c)})}function w(a){if(tinymce.inArray(h,a)!==-1)return;a.parentNode.tagName===d&&(g.split(a.parentNode,a),s(a),l(a.parentNode,!1)),h.push(a)}function x(a){var b,c,d,e;if(tinymce.inArray(h,a)!==-1)return;a=i(a,g);while(g.is(a.parentNode,"ol,ul,li"))g.split(a.parentNode,a);h.push(a),a=g.rename(a,"p"),d=j(a,!1,f.settings.force_br_newlines);if(d===a){b=a.firstChild;while(b)g.isBlock(b)?(b=g.split(b.parentNode,b),e=!0,c=b.nextSibling&&b.nextSibling.firstChild):(c=b.nextSibling,e&&b.tagName==="BR"&&g.remove(b),e=!1),b=c}}var e=this,f=e.ed,g=f.dom,h=[],k=!1,m=!1,n=!1,o,p=f.selection.getSelectedBlocks();a(p,function(a){a=r(a,g),a.tagName===d||a.tagName==="LI"&&a.parentNode.tagName===d?m=!0:a.tagName===b||a.tagName==="LI"&&a.parentNode.tagName===b?k=!0:n=!0}),n&&!k||m||p.length===0?o={LI:w,H1:s,H2:s,H3:s,H4:s,H5:s,H6:s,P:s,BODY:s,DIV:p.length>1?s:v,defaultAction:v,elements:this.selectedBlocks()}:o={defaultAction:x,elements:this.selectedBlocks()},this.process(o)},indent:function(){function d(a){var c=b.create("li",{style:"list-style-type: none;"});return b.insertAfter(c,a),c}function e(a){var c=d(a),e=b.getParent(a,"ol,ul"),f=e.tagName,g=b.getStyle(e,"list-style-type"),h={},i;return g!==""&&(h.style="list-style-type: "+g+";"),i=b.create(f,h),c.appendChild(i),i}function f(d){if(!g(a,d,c)){d=i(d,b);var f=e(d);f.appendChild(d),j(f.parentNode,!1),j(f,!1),c.push(d)}}var a=this.ed,b=a.dom,c=[];this.process({LI:f,defaultAction:this.adjustPaddingFunction(!0),elements:this.selectedBlocks()})},outdent:function(b,c){function k(a){var b,c,j;if(!g(e,a,h)){if(f.getStyle(a,"margin-left")!==""||f.getStyle(a,"padding-left")!=="")return d.adjustPaddingFunction(!1)(a);j=f.getStyle(a,"text-align",!0);if(j==="center"||j==="right"){f.setStyle(a,"text-align","left");return}a=i(a,f),b=a.parentNode,c=a.parentNode.parentNode,c.tagName==="P"?f.split(c,a.parentNode):(f.split(b,a),c.tagName==="LI"?f.split(c,a):f.is(c,"ol,ul")||f.rename(a,"p")),h.push(a)}}var d=this,e=d.ed,f=e.dom,h=[],l=c&&tinymce.is(c,"array")?c:this.selectedBlocks();this.process({LI:k,defaultAction:this.adjustPaddingFunction(!1),elements:l}),a(h,j)},process:function(a){function h(a){var b=tinymce.grep(a.childNodes,function(a){return a.nodeName!=="BR"&&(a.nodeName!=="SPAN"||e.getAttrib(a,"data-mce-type")!="bookmark")&&(a.nodeType!=3||a.nodeValue!=String.fromCharCode(160)&&a.nodeValue!="")});return b.length===0}function i(b){e.removeClass(b,"_mce_act_on");if(!b||b.nodeType!==1||f.length>1&&h(b))return;b=r(b,e);var c=a[b.tagName];c||(c=a.defaultAction),c(b)}function j(a){b.splitSafeEach(a.childNodes,i)}function k(a,b){return b>=0&&a.hasChildNodes()&&b<a.childNodes.length&&a.childNodes[b].tagName==="BR"}function l(){var a=d.getNode(),b=e.getParent(a,"td");return b!==null}var b=this,d=b.ed.selection,e=b.ed.dom,f,g;f=a.elements,g=d.getRng(!0),g.collapsed||(k(g.endContainer,g.endOffset-1)&&(g.setEnd(g.endContainer,g.endOffset-1),d.setRng(g)),k(g.startContainer,g.startOffset)&&(g.setStart(g.startContainer,g.startOffset+1),d.setRng(g)));if(tinymce.isIE8){var m=b.ed.selection.getNode();if(m.tagName==="LI"&&m.parentNode.lastChild!==m){var n=b.ed.getDoc().createTextNode("﻿");m.appendChild(n)}}c=d.getBookmark(),a.OL=a.UL=j,b.splitSafeEach(f,i),d.moveToBookmark(c),c=null,l()||b.ed.execCommand("mceRepaint")},splitSafeEach:function(b,c){tinymce.isGecko&&(/Firefox\/[12]\.[0-9]/.test(navigator.userAgent)||/Firefox\/3\.[0-4]/.test(navigator.userAgent))?this.classBasedEach(b,c):a(b,c)},classBasedEach:function(b,c){var d=this.ed.dom,e,f;a(b,function(a){d.addClass(a,"_mce_act_on")}),e=d.select("._mce_act_on");while(e.length>0)f=e.shift(),d.removeClass(f,"_mce_act_on"),c(f),e=d.select("._mce_act_on")},adjustPaddingFunction:function(a){var b,c,d=this.ed;return b=d.settings.indentation,c=/[a-z%]+/i.exec(b),b=parseInt(b,10),function(e){var f,g;f=parseInt(d.dom.getStyle(e,"margin-left")||0,10)+parseInt(d.dom.getStyle(e,"padding-left")||0,10),a?g=f+b:g=f-b,d.dom.setStyle(e,"padding-left",""),d.dom.setStyle(e,"margin-left",g>0?g+c:"")}},selectedBlocks:function(){var a=this.ed,b=a.selection.getSelectedBlocks();return b.length==0?[a.dom.getRoot()]:b},getInfo:function(){return{longname:"Lists",author:"Moxiecode Systems AB",authorurl:"http://tinymce.moxiecode.com",infourl:"http://wiki.moxiecode.com/index.php/TinyMCE:Plugins/lists",version:tinymce.majorVersion+"."+tinymce.minorVersion}}}),tinymce.PluginManager.add("lists",tinymce.plugins.Lists)})();