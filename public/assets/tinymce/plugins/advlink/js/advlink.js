/* Functions for the advlink plugin popup */
function preinit(){var a;(a=tinyMCEPopup.getParam("external_link_list_url"))&&document.write('<script language="javascript" type="text/javascript" src="'+tinyMCEPopup.editor.documentBaseURI.toAbsolute(a)+'"></script>')}function changeClass(){var a=document.forms[0];a.classes.value=getSelectValue(a,"classlist")}function init(){tinyMCEPopup.resizeToInnerSize();var a=document.forms[0],b=tinyMCEPopup.editor,c=b.selection.getNode(),d="insert",e;document.getElementById("hrefbrowsercontainer").innerHTML=getBrowserHTML("hrefbrowser","href","file","advlink"),document.getElementById("popupurlbrowsercontainer").innerHTML=getBrowserHTML("popupurlbrowser","popupurl","file","advlink"),document.getElementById("targetlistcontainer").innerHTML=getTargetListHTML("targetlist","target"),e=getLinkListHTML("linklisthref","href"),e==""?document.getElementById("linklisthrefrow").style.display="none":document.getElementById("linklisthrefcontainer").innerHTML=e,e=getAnchorListHTML("anchorlist","href"),e==""?document.getElementById("anchorlistrow").style.display="none":document.getElementById("anchorlistcontainer").innerHTML=e,isVisible("hrefbrowser")&&(document.getElementById("href").style.width="260px"),isVisible("popupurlbrowser")&&(document.getElementById("popupurl").style.width="180px"),c=b.dom.getParent(c,"A");if(c==null){var f=b.dom.create("p",null,b.selection.getContent());f.childNodes.length===1&&(c=f.firstChild)}c!=null&&c.nodeName=="A"&&(d="update"),a.insert.value=tinyMCEPopup.getLang(d,"Insert",!0),setPopupControlsDisabled(!0);if(d=="update"){var g=b.dom.getAttrib(c,"href"),h=b.dom.getAttrib(c,"onclick");setFormValue("href",g),setFormValue("title",b.dom.getAttrib(c,"title")),setFormValue("id",b.dom.getAttrib(c,"id")),setFormValue("style",b.dom.getAttrib(c,"style")),setFormValue("rel",b.dom.getAttrib(c,"rel")),setFormValue("rev",b.dom.getAttrib(c,"rev")),setFormValue("charset",b.dom.getAttrib(c,"charset")),setFormValue("hreflang",b.dom.getAttrib(c,"hreflang")),setFormValue("dir",b.dom.getAttrib(c,"dir")),setFormValue("lang",b.dom.getAttrib(c,"lang")),setFormValue("tabindex",b.dom.getAttrib(c,"tabindex",typeof c.tabindex!="undefined"?c.tabindex:"")),setFormValue("accesskey",b.dom.getAttrib(c,"accesskey",typeof c.accesskey!="undefined"?c.accesskey:"")),setFormValue("type",b.dom.getAttrib(c,"type")),setFormValue("onfocus",b.dom.getAttrib(c,"onfocus")),setFormValue("onblur",b.dom.getAttrib(c,"onblur")),setFormValue("onclick",h),setFormValue("ondblclick",b.dom.getAttrib(c,"ondblclick")),setFormValue("onmousedown",b.dom.getAttrib(c,"onmousedown")),setFormValue("onmouseup",b.dom.getAttrib(c,"onmouseup")),setFormValue("onmouseover",b.dom.getAttrib(c,"onmouseover")),setFormValue("onmousemove",b.dom.getAttrib(c,"onmousemove")),setFormValue("onmouseout",b.dom.getAttrib(c,"onmouseout")),setFormValue("onkeypress",b.dom.getAttrib(c,"onkeypress")),setFormValue("onkeydown",b.dom.getAttrib(c,"onkeydown")),setFormValue("onkeyup",b.dom.getAttrib(c,"onkeyup")),setFormValue("target",b.dom.getAttrib(c,"target")),setFormValue("classes",b.dom.getAttrib(c,"class")),h!=null&&h.indexOf("window.open")!=-1?parseWindowOpen(h):parseFunction(h),selectByValue(a,"dir",b.dom.getAttrib(c,"dir")),selectByValue(a,"rel",b.dom.getAttrib(c,"rel")),selectByValue(a,"rev",b.dom.getAttrib(c,"rev")),selectByValue(a,"linklisthref",g),g.charAt(0)=="#"&&selectByValue(a,"anchorlist",g),addClassesToList("classlist","advlink_styles"),selectByValue(a,"classlist",b.dom.getAttrib(c,"class"),!0),selectByValue(a,"targetlist",b.dom.getAttrib(c,"target"),!0)}else addClassesToList("classlist","advlink_styles")}function checkPrefix(a){a.value&&Validator.isEmail(a)&&!/^\s*mailto:/i.test(a.value)&&confirm(tinyMCEPopup.getLang("advlink_dlg.is_email"))&&(a.value="mailto:"+a.value),/^\s*www\./i.test(a.value)&&confirm(tinyMCEPopup.getLang("advlink_dlg.is_external"))&&(a.value="http://"+a.value)}function setFormValue(a,b){document.forms[0].elements[a].value=b}function parseWindowOpen(a){var b=document.forms[0];a.indexOf("return false;")!=-1?(b.popupreturn.checked=!0,a=a.replace("return false;","")):b.popupreturn.checked=!1;var c=parseLink(a);if(c!=null){b.ispopup.checked=!0,setPopupControlsDisabled(!1);var d=parseOptions(c.options),e=c.url;b.popupname.value=c.target,b.popupurl.value=e,b.popupwidth.value=getOption(d,"width"),b.popupheight.value=getOption(d,"height"),b.popupleft.value=getOption(d,"left"),b.popuptop.value=getOption(d,"top"),b.popupleft.value.indexOf("screen")!=-1&&(b.popupleft.value="c"),b.popuptop.value.indexOf("screen")!=-1&&(b.popuptop.value="c"),b.popuplocation.checked=getOption(d,"location")=="yes",b.popupscrollbars.checked=getOption(d,"scrollbars")=="yes",b.popupmenubar.checked=getOption(d,"menubar")=="yes",b.popupresizable.checked=getOption(d,"resizable")=="yes",b.popuptoolbar.checked=getOption(d,"toolbar")=="yes",b.popupstatus.checked=getOption(d,"status")=="yes",b.popupdependent.checked=getOption(d,"dependent")=="yes",buildOnClick()}}function parseFunction(a){var b=document.forms[0],c=parseLink(a)}function getOption(a,b){return typeof a[b]=="undefined"?"":a[b]}function setPopupControlsDisabled(a){var b=document.forms[0];b.popupname.disabled=a,b.popupurl.disabled=a,b.popupwidth.disabled=a,b.popupheight.disabled=a,b.popupleft.disabled=a,b.popuptop.disabled=a,b.popuplocation.disabled=a,b.popupscrollbars.disabled=a,b.popupmenubar.disabled=a,b.popupresizable.disabled=a,b.popuptoolbar.disabled=a,b.popupstatus.disabled=a,b.popupreturn.disabled=a,b.popupdependent.disabled=a,setBrowserDisabled("popupurlbrowser",a)}function parseLink(a){a=a.replace(new RegExp("&#39;","g"),"'");var b=a.replace(new RegExp("\\s*([A-Za-z0-9.]*)\\s*\\(.*","gi"),"$1"),c=templates[b];if(c){var d=c.match(new RegExp("'?\\$\\{[A-Za-z0-9.]*\\}'?","gi")),e="\\s*[A-Za-z0-9.]*\\s*\\(",f="";for(var g=0;g<d.length;g++)d[g].indexOf("'${")!=-1?e+="'(.*)'":e+="([0-9]*)",f+="$"+(g+1),d[g]=d[g].replace(new RegExp("[^A-Za-z0-9]","gi"),""),g!=d.length-1?(e+="\\s*,\\s*",f+="<delim>"):e+=".*";e+="\\);?";var h=[];h._function=b;var i=a.replace(new RegExp(e,"gi"),f).split("<delim>");for(var g=0;g<d.length;g++)h[d[g]]=i[g];return h}return null}function parseOptions(a){if(a==null||a=="")return[];a=a.toLowerCase(),a=a.replace(/;/g,","),a=a.replace(/[^0-9a-z=,]/g,"");var b=a.split(","),c=[];for(var d=0;d<b.length;d++){var e=b[d].split("=");e.length==2&&(c[e[0]]=e[1])}return c}function buildOnClick(){var a=document.forms[0];if(!a.ispopup.checked){a.onclick.value="";return}var b="window.open('",c=a.popupurl.value;b+=c+"','",b+=a.popupname.value+"','",a.popuplocation.checked&&(b+="location=yes,"),a.popupscrollbars.checked&&(b+="scrollbars=yes,"),a.popupmenubar.checked&&(b+="menubar=yes,"),a.popupresizable.checked&&(b+="resizable=yes,"),a.popuptoolbar.checked&&(b+="toolbar=yes,"),a.popupstatus.checked&&(b+="status=yes,"),a.popupdependent.checked&&(b+="dependent=yes,"),a.popupwidth.value!=""&&(b+="width="+a.popupwidth.value+","),a.popupheight.value!=""&&(b+="height="+a.popupheight.value+","),a.popupleft.value!=""&&(a.popupleft.value!="c"?b+="left="+a.popupleft.value+",":b+="left='+(screen.availWidth/2-"+a.popupwidth.value/2+")+',"),a.popuptop.value!=""&&(a.popuptop.value!="c"?b+="top="+a.popuptop.value+",":b+="top='+(screen.availHeight/2-"+a.popupheight.value/2+")+',"),b.charAt(b.length-1)==","&&(b=b.substring(0,b.length-1)),b+="');",a.popupreturn.checked&&(b+="return false;"),a.onclick.value=b,a.href.value==""&&(a.href.value=c)}function setAttrib(a,b,c){var d=document.forms[0],e=d.elements[b.toLowerCase()],f=tinyMCEPopup.editor.dom;if(typeof c=="undefined"||c==null)c="",e&&(c=e.value);b=="style"&&(c=f.serializeStyle(f.parseStyle(c),"a")),f.setAttrib(a,b,c)}function getAnchorListHTML(a,b){var c=tinyMCEPopup.editor,d=c.dom.select("a"),e,f,g,h="";for(f=0,g=d.length;f<g;f++)(e=c.dom.getAttrib(d[f],"name"))!=""&&(h+='<option value="#'+e+'">'+e+"</option>");return h==""?"":(h='<select id="'+a+'" name="'+a+'" class="mceAnchorList"'+' onchange="this.form.'+b+'.value=this.options[this.selectedIndex].value"'+">"+'<option value="">---</option>'+h+"</select>",h)}function insertAction(){var a=tinyMCEPopup.editor,b,c,d;b=a.selection.getNode(),checkPrefix(document.forms[0].href),b=a.dom.getParent(b,"A");if(!document.forms[0].href.value){d=a.selection.getBookmark(),a.dom.remove(b,1),a.selection.moveToBookmark(d),tinyMCEPopup.execCommand("mceEndUndoLevel"),tinyMCEPopup.close();return}if(b==null){a.getDoc().execCommand("unlink",!1,null),tinyMCEPopup.execCommand("mceInsertLink",!1,"#mce_temp_url#",{skip_undo:1}),c=tinymce.grep(a.dom.select("a"),function(b){return a.dom.getAttrib(b,"href")=="#mce_temp_url#"});for(d=0;d<c.length;d++)setAllAttribs(b=c[d])}else setAllAttribs(b);if(b.childNodes.length!=1||b.firstChild.nodeName!="IMG")a.focus(),a.selection.select(b),a.selection.collapse(0),tinyMCEPopup.storeSelection();tinyMCEPopup.execCommand("mceEndUndoLevel"),tinyMCEPopup.close()}function setAllAttribs(a){var b=document.forms[0],c=b.href.value.replace(/ /g,"%20"),d=getSelectValue(b,"targetlist");setAttrib(a,"href",c),setAttrib(a,"title"),setAttrib(a,"target",d=="_self"?"":d),setAttrib(a,"id"),setAttrib(a,"style"),setAttrib(a,"class",getSelectValue(b,"classlist")),setAttrib(a,"rel"),setAttrib(a,"rev"),setAttrib(a,"charset"),setAttrib(a,"hreflang"),setAttrib(a,"dir"),setAttrib(a,"lang"),setAttrib(a,"tabindex"),setAttrib(a,"accesskey"),setAttrib(a,"type"),setAttrib(a,"onfocus"),setAttrib(a,"onblur"),setAttrib(a,"onclick"),setAttrib(a,"ondblclick"),setAttrib(a,"onmousedown"),setAttrib(a,"onmouseup"),setAttrib(a,"onmouseover"),setAttrib(a,"onmousemove"),setAttrib(a,"onmouseout"),setAttrib(a,"onkeypress"),setAttrib(a,"onkeydown"),setAttrib(a,"onkeyup"),tinyMCE.isMSIE5&&(a.outerHTML=a.outerHTML)}function getSelectValue(a,b){var c=a.elements[b];return!c||c.options==null||c.selectedIndex==-1?"":c.options[c.selectedIndex].value}function getLinkListHTML(a,b,c){if(typeof tinyMCELinkList=="undefined"||tinyMCELinkList.length==0)return"";var d="";d+='<select id="'+a+'" name="'+a+'"',d+=' class="mceLinkList" onfoc2us="tinyMCE.addSelectAccessibility(event, this, window);" onchange="this.form.'+b+".value=",d+="this.options[this.selectedIndex].value;",typeof c!="undefined"&&(d+=c+"('"+b+"',this.options[this.selectedIndex].text,this.options[this.selectedIndex].value);"),d+='"><option value="">---</option>';for(var e=0;e<tinyMCELinkList.length;e++)d+='<option value="'+tinyMCELinkList[e][1]+'">'+tinyMCELinkList[e][0]+"</option>";return d+="</select>",d}function getTargetListHTML(a,b){var c=tinyMCEPopup.getParam("theme_advanced_link_targets","").split(";"),d="";d+='<select id="'+a+'" name="'+a+'" onfocus="tinyMCE.addSelectAccessibility(event, this, window);" onchange="this.form.'+b+".value=",d+='this.options[this.selectedIndex].value;">',d+='<option value="_self">'+tinyMCEPopup.getLang("advlink_dlg.target_same")+"</option>",d+='<option value="_blank">'+tinyMCEPopup.getLang("advlink_dlg.target_blank")+" (_blank)</option>",d+='<option value="_parent">'+tinyMCEPopup.getLang("advlink_dlg.target_parent")+" (_parent)</option>",d+='<option value="_top">'+tinyMCEPopup.getLang("advlink_dlg.target_top")+" (_top)</option>";for(var e=0;e<c.length;e++){var f,g;if(c[e]=="")continue;f=c[e].split("=")[0],g=c[e].split("=")[1],d+='<option value="'+f+'">'+g+" ("+f+")</option>"}return d+="</select>",d}tinyMCEPopup.requireLangPack();var templates={"window.open":"window.open('${url}','${target}','${options}')"};preinit(),tinyMCEPopup.onInit.add(init);