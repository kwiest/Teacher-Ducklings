/**
 * editor_plugin_src.js
 *
 * Copyright 2009, Moxiecode Systems AB
 * Released under LGPL License.
 *
 * License: http://tinymce.moxiecode.com/license
 * Contributing: http://tinymce.moxiecode.com/contributing
 */
(function(){var a=tinymce.each;tinymce.create("tinymce.plugins.TemplatePlugin",{init:function(b,c){var d=this;d.editor=b,b.addCommand("mceTemplate",function(a){b.windowManager.open({file:c+"/template.htm",width:b.getParam("template_popup_width",750),height:b.getParam("template_popup_height",600),inline:1},{plugin_url:c})}),b.addCommand("mceInsertTemplate",d._insertTemplate,d),b.addButton("template",{title:"template.desc",cmd:"mceTemplate"}),b.onPreProcess.add(function(b,c){var e=b.dom;a(e.select("div",c.node),function(c){e.hasClass(c,"mceTmpl")&&(a(e.select("*",c),function(a){e.hasClass(a,b.getParam("template_mdate_classes","mdate").replace(/\s+/g,"|"))&&(a.innerHTML=d._getDateTime(new Date,b.getParam("template_mdate_format",b.getLang("template.mdate_format"))))}),d._replaceVals(c))})})},getInfo:function(){return{longname:"Template plugin",author:"Moxiecode Systems AB",authorurl:"http://www.moxiecode.com",infourl:"http://wiki.moxiecode.com/index.php/TinyMCE:Plugins/template",version:tinymce.majorVersion+"."+tinymce.minorVersion}},_insertTemplate:function(b,c){function j(a,b){return(new RegExp("\\b"+b+"\\b","g")).test(a.className)}var d=this,e=d.editor,f,g,h=e.dom,i=e.selection.getContent();f=c.content,a(d.editor.getParam("template_replace_values"),function(a,b){typeof a!="function"&&(f=f.replace(new RegExp("\\{\\$"+b+"\\}","g"),a))}),g=h.create("div",null,f),n=h.select(".mceTmpl",g),n&&n.length>0&&(g=h.create("div",null),g.appendChild(n[0].cloneNode(!0))),a(h.select("*",g),function(a){j(a,e.getParam("template_cdate_classes","cdate").replace(/\s+/g,"|"))&&(a.innerHTML=d._getDateTime(new Date,e.getParam("template_cdate_format",e.getLang("template.cdate_format")))),j(a,e.getParam("template_mdate_classes","mdate").replace(/\s+/g,"|"))&&(a.innerHTML=d._getDateTime(new Date,e.getParam("template_mdate_format",e.getLang("template.mdate_format")))),j(a,e.getParam("template_selected_content_classes","selcontent").replace(/\s+/g,"|"))&&(a.innerHTML=i)}),d._replaceVals(g),e.execCommand("mceInsertContent",!1,g.innerHTML),e.addVisual()},_replaceVals:function(b){var c=this.editor.dom,d=this.editor.getParam("template_replace_values");a(c.select("*",b),function(b){a(d,function(a,f){c.hasClass(b,f)&&typeof d[f]=="function"&&d[f](b)})})},_getDateTime:function(a,b){function c(a,b){var c;a=""+a;if(a.length<b)for(c=0;c<b-a.length;c++)a="0"+a;return a}return b?(b=b.replace("%D","%m/%d/%y"),b=b.replace("%r","%I:%M:%S %p"),b=b.replace("%Y",""+a.getFullYear()),b=b.replace("%y",""+a.getYear()),b=b.replace("%m",c(a.getMonth()+1,2)),b=b.replace("%d",c(a.getDate(),2)),b=b.replace("%H",""+c(a.getHours(),2)),b=b.replace("%M",""+c(a.getMinutes(),2)),b=b.replace("%S",""+c(a.getSeconds(),2)),b=b.replace("%I",""+((a.getHours()+11)%12+1)),b=b.replace("%p",""+(a.getHours()<12?"AM":"PM")),b=b.replace("%B",""+this.editor.getLang("template_months_long").split(",")[a.getMonth()]),b=b.replace("%b",""+this.editor.getLang("template_months_short").split(",")[a.getMonth()]),b=b.replace("%A",""+this.editor.getLang("template_day_long").split(",")[a.getDay()]),b=b.replace("%a",""+this.editor.getLang("template_day_short").split(",")[a.getDay()]),b=b.replace("%%","%"),b):""}}),tinymce.PluginManager.add("template",tinymce.plugins.TemplatePlugin)})();